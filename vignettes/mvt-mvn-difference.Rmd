---
title: "MVT vs. MVN random field differences"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, eval=FALSE}
m_wrong <- rrfield(y ~ 1, data = s$dat, time = "time", station = "station_id",
    lat = "lat", lon = "lon", nknots = nknots,
    iter = ITER, chains = CHAINS, seed = SEED,
    estimate_df = FALSE, fixed_df_value = 1e6)
  pp_wrong <- predict(m_wrong, newdata = s$dat, interval = "prediction")

  mean(s$dat$y > pp$conf_low & s$dat$y < pp$conf_high)
  mean(s$dat$y > pp_wrong$conf_low & s$dat$y < pp_wrong$conf_high)
  hist((pp_wrong$conf_high - pp_wrong$conf_low) / (pp$conf_high - pp$conf_low))

  sum((pp$estimate - s$dat$y)^2)
  sum((pp_wrong$estimate - s$dat$y)^2)

  d <- s$dat;d <- data.frame(d, pp)
  library(ggplot2)
  ggplot(d, aes(lon, lat, colour = estimate)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)

  d_wrong <- s$dat;d_wrong <- data.frame(d_wrong, pp_wrong)
  ggplot(d_wrong, aes(lon, lat, colour = estimate)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)


  ggplot(d, aes(lon, lat, colour = y)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)

  library(dplyr)
  q <- data.frame(d, select(d_wrong, estimate) %>% rename(est_wrong = estimate))
  ggplot(q, aes(lon, lat, colour = estimate - est_wrong)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)

  ggplot(d, aes(lon, lat, colour = estimate - y)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)

  ggplot(d_wrong, aes(lon, lat, colour = estimate - y)) +
    geom_point(size = 2) +
    scale_color_gradient2() +
    facet_wrap(~time)

max(d_wrong$estimate - d_wrong$y)
max(d$estimate - d$y)
b <- broom::tidyMCMC(m$model, estimate.method = "median")
head(b)
b_wrong <- broom::tidyMCMC(m_wrong$model, estimate.method = "median")
head(b_wrong)

```

